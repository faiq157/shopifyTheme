{{ 'johnny-dang-header.css' | asset_url | stylesheet_tag }}

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const header = document.querySelector('.jd-header-wrapper');
    const mobileToggle = document.querySelector('.jd-header__mobile-toggle');
    const mobileNav = document.querySelector('.jd-header__mobile-nav');

    // Handle scroll effect with throttling for better performance
    let ticking = false;
    function handleScroll() {
      if (window.scrollY > 50) {
        header.classList.add('scrolled');
      } else {
        header.classList.remove('scrolled');
      }
    }

    function requestTick() {
      if (!ticking) {
        requestAnimationFrame(handleScroll);
        ticking = true;
        setTimeout(() => { ticking = false; }, 16);
      }
    }

    window.addEventListener('scroll', requestTick, { passive: true });

    // Handle mobile menu toggle
    if (mobileToggle && mobileNav) {
      mobileToggle.addEventListener('click', function() {
        mobileNav.classList.toggle('active');
        this.setAttribute('aria-expanded', mobileNav.classList.contains('active'));
      });
    }
  });
</script>

<div class="jd-header-wrapper{% if request.page_type == 'index' %} home-page{% endif %}">
  <header class="jd-header">
    <!-- Logo -->
    <div class="jd-header__logo">
      <a href="{{ routes.root_url }}" class="jd-header__logo-link">
        <img 
          src="{{ 'headerlogo.png' | asset_url }}" 
          alt="Johnny Dang & Co"
          width="200"
          height="80"
          loading="eager"
        >
      </a>
    </div>

    <!-- Desktop Navigation -->
    <nav class="jd-header__nav" aria-label="Main navigation">
      {% if section.settings.menu != blank %}
        <ul class="jd-header__nav-list">
          {% for link in linklists[section.settings.menu].links %}
            <li class="jd-header__nav-item">
              <a href="{{ link.url }}" class="jd-header__nav-link">
                {{ link.title }}
              </a>
            </li>
          {% endfor %}
        </ul>
      {% endif %}
    </nav>

    <!-- Header Actions -->
    <div class="jd-header__actions">
      <!-- Search -->
      {% if section.settings.enable_search %}
        <a href="{{ routes.search_url }}" class="jd-header__icon" aria-label="Search">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M21 21L16.514 16.506L21 21ZM19 10.5C19 15.194 15.194 19 10.5 19C5.806 19 2 15.194 2 10.5C2 5.806 5.806 2 10.5 2C15.194 2 19 5.806 19 10.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </a>
      {% endif %}

      <!-- Account -->
      {% if shop.customer_accounts_enabled %}
        <a 
          href="{% if customer %}{{ routes.account_url }}{% else %}{{ routes.account_login_url }}{% endif %}" 
          class="jd-header__icon" 
          aria-label="{% if customer %}Account{% else %}Log in{% endif %}"
        >
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M20 21V19C20 16.7909 18.2091 15 16 15H8C5.79086 15 4 16.7909 4 19V21M16 7C16 9.20914 14.2091 11 12 11C9.79086 11 8 9.20914 8 7C8 4.79086 9.79086 3 12 3C14.2091 3 16 4.79086 16 7Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </a>
      {% endif %}

      <!-- Wishlist -->
      {% if section.settings.enable_wishlist %}
        <a href="#" class="jd-header__icon" aria-label="Wishlist">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M20.84 4.61C20.3292 4.099 19.7228 3.69364 19.0554 3.41708C18.3879 3.14052 17.6725 2.99817 16.95 2.99817C16.2275 2.99817 15.5121 3.14052 14.8446 3.41708C14.1772 3.69364 13.5708 4.099 13.06 4.61L12 5.67L10.94 4.61C9.9083 3.5783 8.50903 2.9987 7.05 2.9987C5.59096 2.9987 4.19169 3.5783 3.16 4.61C2.1283 5.6417 1.5487 7.04097 1.5487 8.5C1.5487 9.95903 2.1283 11.3583 3.16 12.39L4.22 13.45L12 21.23L19.78 13.45L20.84 12.39C21.351 11.8792 21.7563 11.2728 22.0329 10.6053C22.3095 9.93789 22.4518 9.22248 22.4518 8.5C22.4518 7.77752 22.3095 7.06211 22.0329 6.39467C21.7563 5.72723 21.351 5.1208 20.84 4.61Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </a>
      {% endif %}

      <!-- Cart -->
      <a href="{{ routes.cart_url }}" class="jd-header__icon" aria-label="Cart">
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M3 3H5L5.4 5M7 13H17L21 5H5.4M7 13L5.4 5M7 13L4.7 15.3C4.3 15.7 4.6 16.5 5.1 16.5H17M17 13V16.5M9 19.5C9.8 19.5 10.5 20.2 10.5 21S9.8 22.5 9 22.5 7.5 21.8 7.5 21 8.2 19.5 9 19.5ZM20 19.5C20.8 19.5 21.5 20.2 21.5 21S20.8 22.5 20 22.5 18.5 21.8 18.5 21 19.2 19.5 20 19.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        {% if cart.item_count > 0 %}
          <span class="jd-header__cart-count">{{ cart.item_count }}</span>
        {% endif %}
      </a>

      <!-- Mobile Menu Toggle -->
      <button 
        class="jd-header__mobile-toggle" 
        aria-label="Toggle mobile menu"
        aria-expanded="false"
      >
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M3 12H21M3 6H21M3 18H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>
  </header>

  <!-- Mobile Navigation -->
  <nav class="jd-header__mobile-nav" aria-label="Mobile navigation">
    {% if section.settings.menu != blank %}
      <ul class="jd-header__mobile-nav-list">
        {% for link in linklists[section.settings.menu].links %}
          <li class="jd-header__mobile-nav-item">
            <a href="{{ link.url }}" class="jd-header__mobile-nav-link">
              {{ link.title }}
            </a>
          </li>
        {% endfor %}
      </ul>
    {% endif %}
  </nav>
</div>

{% schema %}
{
  "name": "JD Header",
  "tag": "header",
  "class": "jd-header-section",
  "settings": [
    {
      "type": "link_list",
      "id": "menu",
      "label": "Main Menu",
      "default": "main-menu"
    },
    {
      "type": "checkbox",
      "id": "enable_search",
      "label": "Enable Search",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "enable_wishlist",
      "label": "Enable Wishlist",
      "default": true
    }
  ]
}
{% endschema %}