{{ 'jd-product-row.css' | asset_url | stylesheet_tag }}

{%- liquid
  assign collection = collections[section.settings.collection]
  assign products_to_show = section.settings.products_to_show | default: 4
  assign products = collection.products | limit: products_to_show
-%}

<section class="jd-product-row section-{{ section.id }}-padding">
  <div class="page-width">
    {% if section.settings.title != blank %}
      <div class="jd-product-row__header">
        <h2 class="jd-product-row__title">{{ section.settings.title }}</h2>
        {% if section.settings.show_view_all and section.settings.view_all_link != blank %}
          <a href="{{ section.settings.view_all_link }}" class="jd-product-row__view-all">
            {{ section.settings.view_all_text | default: 'VIEW ALL' }}
            <svg class="jd-product-row__arrow" width="12" height="12" viewBox="0 0 12 12" fill="none">
              <path d="M1 11L11 1M11 1H1M11 1V11" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
          </a>
        {% endif %}
      </div>
    {% endif %}

    <div class="jd-product-row__container">
      <div class="jd-product-row__grid">
        {% for product in products %}
          <div class="jd-product-row__item">
            <div class="jd-product-row__product">
              <div class="jd-product-row__image-wrapper">
                <a href="{{ product.url }}" class="jd-product-row__image-link">
                  {% if product.featured_image %}
                    <img 
                      class="jd-product-row__image"
                      src="{{ product.featured_image | image_url: width: 300 }}"
                      alt="{{ product.featured_image.alt | default: product.title }}"
                      width="300"
                      height="300"
                      loading="lazy"
                    >
                  {% else %}
                    <div class="jd-product-row__placeholder">
                      <svg width="100" height="100" viewBox="0 0 100 100" fill="none">
                        <rect width="100" height="100" fill="#f3f3f3"/>
                        <path d="M50 30L70 50L50 70L30 50L50 30Z" fill="#ddd"/>
                      </svg>
                    </div>
                  {% endif %}
                </a>
              </div>
              
              <div class="jd-product-row__content">
                <h3 class="jd-product-row__product-title">
                  <a href="{{ product.url }}">{{ product.title }}</a>
                </h3>
                
                <div class="jd-product-row__price">
                  {% if product.compare_at_price > product.price %}
                    <span class="jd-product-row__price-compare">{{ product.compare_at_price | money }}</span>
                    <span class="jd-product-row__price-sale">{{ product.price | money }}</span>
                  {% else %}
                    <span class="jd-product-row__price-regular">{{ product.price | money }}</span>
                  {% endif %}
                </div>
                
                {% if product.available %}
                  <form action="{{ routes.cart_add_url }}" method="post" enctype="multipart/form-data">
                    <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
                    <button type="submit" class="jd-product-row__add-to-cart">
                      Add to Cart
                    </button>
                  </form>
                {% else %}
                  <button class="jd-product-row__add-to-cart jd-product-row__add-to-cart--sold-out" disabled>
                    Sold Out
                  </button>
                {% endif %}
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
  </div>
</section>

{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }

  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }
{%- endstyle -%}

{% schema %}
{
  "name": "JD Product Row",
  "tag": "section",
  "class": "jd-product-row-section",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Heading",
      "default": "Featured Products"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection"
    },
    {
      "type": "range",
      "id": "products_to_show",
      "min": 2,
      "max": 8,
      "step": 1,
      "label": "Number of products to show",
      "default": 4
    },
    {
      "type": "checkbox",
      "id": "show_view_all",
      "label": "Show 'View All' button",
      "default": true
    },
    {
      "type": "text",
      "id": "view_all_text",
      "label": "View All button text",
      "default": "VIEW ALL"
    },
    {
      "type": "url",
      "id": "view_all_link",
      "label": "View All link"
    },
    {
      "type": "header",
      "content": "Section padding"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Top padding",
      "default": 60
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Bottom padding",
      "default": 40
    }
  ],
  "presets": [
    {
      "name": "JD Product Row",
      "settings": {
        "title": "Featured Products",
        "products_to_show": 4
      }
    }
  ]
}
{% endschema %}
